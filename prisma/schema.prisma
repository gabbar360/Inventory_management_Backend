generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  hsnCode   String   @unique @map("hsn_code")
  gstRate   Float    @map("gst_rate")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]

  @@map("categories")
}

model Product {
  id         Int      @id @default(autoincrement())
  name       String
  grade      String?
  categoryId Int      @map("category_id")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  category     Category       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  inwardItems  InwardItem[]
  outwardItems OutwardItem[]
  stockBatches StockBatch[]

  @@unique([name, grade])
  @@map("products")
}

model Vendor {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  email     String?
  phone     String?
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inwardInvoices InwardInvoice[]
  stockBatches   StockBatch[]

  @@map("vendors")
}

model Customer {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  email     String?
  phone     String?
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  outwardInvoices OutwardInvoice[]

  @@map("customers")
}

model Location {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inwardInvoices  InwardInvoice[]
  outwardInvoices OutwardInvoice[]
  stockBatches    StockBatch[]

  @@map("locations")
}

model InwardInvoice {
  id         Int      @id @default(autoincrement())
  invoiceNo  String   @unique @map("invoice_no")
  date       DateTime
  vendorId   Int      @map("vendor_id")
  locationId Int      @map("location_id")
  totalCost  Float    @map("total_cost")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  vendor   Vendor        @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  location Location      @relation(fields: [locationId], references: [id], onDelete: Cascade)
  items    InwardItem[]

  @@map("inward_invoices")
}

model InwardItem {
  id              Int    @id @default(autoincrement())
  inwardInvoiceId Int    @map("inward_invoice_id")
  productId       Int    @map("product_id")
  boxes           Int
  packPerBox      Int    @map("pack_per_box")
  packPerPiece    Int    @map("pack_per_piece")
  totalPacks      Int    @map("total_packs")
  totalPcs        Int    @map("total_pcs")
  ratePerBox      Float  @map("rate_per_box")
  ratePerPack     Float  @map("rate_per_pack")
  ratePerPcs      Float  @map("rate_per_pcs")
  gstAmount       Float  @map("gst_amount")
  totalCost       Float  @map("total_cost")

  inwardInvoice InwardInvoice @relation(fields: [inwardInvoiceId], references: [id], onDelete: Cascade)
  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("inward_items")
}

model OutwardInvoice {
  id         Int      @id @default(autoincrement())
  invoiceNo  String   @unique @map("invoice_no")
  date       DateTime
  customerId Int      @map("customer_id")
  locationId Int      @map("location_id")
  saleType   String   @map("sale_type") // 'export' or 'domestic'
  expense    Float    @default(0)
  totalCost  Float    @map("total_cost")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  customer Customer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  location Location       @relation(fields: [locationId], references: [id], onDelete: Cascade)
  items    OutwardItem[]

  @@map("outward_invoices")
}

model OutwardItem {
  id               Int    @id @default(autoincrement())
  outwardInvoiceId Int    @map("outward_invoice_id")
  productId        Int    @map("product_id")
  stockBatchId     Int    @map("stock_batch_id")
  saleUnit         String @map("sale_unit") // 'box' or 'piece'
  quantity         Int
  ratePerUnit      Float  @map("rate_per_unit")
  totalCost        Float  @map("total_cost")

  outwardInvoice OutwardInvoice @relation(fields: [outwardInvoiceId], references: [id], onDelete: Cascade)
  product        Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockBatch     StockBatch     @relation(fields: [stockBatchId], references: [id], onDelete: Cascade)

  @@map("outward_items")
}

model StockBatch {
  id               Int      @id @default(autoincrement())
  productId        Int      @map("product_id")
  vendorId         Int      @map("vendor_id")
  locationId       Int      @map("location_id")
  inwardDate       DateTime @map("inward_date")
  boxes            Int
  packPerBox       Int      @map("pack_per_box")
  packPerPiece     Int      @map("pack_per_piece")
  totalPacks       Int      @map("total_packs")
  totalPcs         Int      @map("total_pcs")
  remainingBoxes   Int      @map("remaining_boxes")
  remainingPacks   Int      @map("remaining_packs")
  remainingPcs     Int      @map("remaining_pcs")
  costPerBox       Float    @map("cost_per_box")
  costPerPack      Float    @map("cost_per_pack")
  costPerPcs       Float    @map("cost_per_pcs")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  product      Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  vendor       Vendor        @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  location     Location      @relation(fields: [locationId], references: [id], onDelete: Cascade)
  outwardItems OutwardItem[]

  @@map("stock_batches")
}

model StockMovement {
  id            Int      @id @default(autoincrement())
  type          String   // 'inward' or 'outward'
  referenceId   Int      @map("reference_id") // InwardInvoice or OutwardInvoice ID
  productId     Int      @map("product_id")
  locationId    Int      @map("location_id")
  quantity      Int
  movementDate  DateTime @map("movement_date")
  createdAt     DateTime @default(now())

  @@map("stock_movements")
}